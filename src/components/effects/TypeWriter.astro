---
// Typewriter effect that cycles through words
interface Props {
  words: string[];
  typingSpeed?: number;
  deletingSpeed?: number;
  pauseDuration?: number;
  class?: string;
}

const {
  words,
  typingSpeed = 100,
  deletingSpeed = 50,
  pauseDuration = 2000,
  class: className = '',
} = Astro.props;
---

<span
  class:list={['typewriter', className]}
  data-words={JSON.stringify(words)}
  data-typing-speed={typingSpeed}
  data-deleting-speed={deletingSpeed}
  data-pause-duration={pauseDuration}
>
  <span class="typewriter-text"></span>
  <span class="typewriter-cursor">|</span>
</span>

<style>
  .typewriter {
    display: inline-flex;
    align-items: baseline;
  }

  .typewriter-cursor {
    animation: blink 0.8s infinite;
    color: var(--color-power-red);
    font-weight: 100;
    margin-left: 2px;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }
</style>

<script>
  document.querySelectorAll('.typewriter').forEach((el) => {
    const textEl = el.querySelector('.typewriter-text') as HTMLElement;
    const words = JSON.parse(el.getAttribute('data-words') || '[]');
    const typingSpeed = parseInt(el.getAttribute('data-typing-speed') || '100');
    const deletingSpeed = parseInt(el.getAttribute('data-deleting-speed') || '50');
    const pauseDuration = parseInt(el.getAttribute('data-pause-duration') || '2000');

    let wordIndex = 0;
    let charIndex = 0;
    let isDeleting = false;

    function type() {
      const currentWord = words[wordIndex];

      if (isDeleting) {
        textEl.textContent = currentWord.substring(0, charIndex - 1);
        charIndex--;
      } else {
        textEl.textContent = currentWord.substring(0, charIndex + 1);
        charIndex++;
      }

      let timeout = isDeleting ? deletingSpeed : typingSpeed;

      if (!isDeleting && charIndex === currentWord.length) {
        timeout = pauseDuration;
        isDeleting = true;
      } else if (isDeleting && charIndex === 0) {
        isDeleting = false;
        wordIndex = (wordIndex + 1) % words.length;
        timeout = 500;
      }

      setTimeout(type, timeout);
    }

    type();
  });
</script>
